<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edi√ß√£o ‚Äî Pro dia nascer Feliz</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <style>
        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-spinner {
            width: 50px; height: 50px;
            border: 4px solid rgba(255,107,53,0.2);
            border-top-color: #FF6B35;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }

        .edition-meta {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,107,53,0.08);
            border: 1px solid rgba(255,107,53,0.2);
            color: #FF6B35;
            font-size: 13px;
            font-weight: 700;
            padding: 6px 16px;
            border-radius: 100px;
            margin-bottom: 32px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .edition-card {
            background: #fff;
            border: 1px solid #efefef;
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            opacity: 0;
            transform: translateY(16px);
            animation: fadeUp 0.5s ease forwards;
        }
        .edition-card:nth-child(1) { animation-delay: 0.05s; }
        .edition-card:nth-child(2) { animation-delay: 0.15s; }
        .edition-card:nth-child(3) { animation-delay: 0.25s; }

        @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

        .card-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            padding: 5px 12px;
            border-radius: 100px;
            margin-bottom: 16px;
        }
        .tag-viral       { background: #fff3e0; color: #e65100; }
        .tag-conspiracao { background: #f3e5f5; color: #7b1fa2; }
        .tag-bastidores  { background: #e8f5e9; color: #2e7d32; }

        .card-lead {
            font-size: 20px;
            font-weight: 800;
            color: #111;
            line-height: 1.3;
            margin-bottom: 14px;
        }
        .card-body {
            font-size: 15px;
            line-height: 1.8;
            color: #444;
        }
        .card-nugget {
            margin-top: 20px;
            padding: 14px 18px;
            background: #faf9f7;
            border-left: 3px solid #FF6B35;
            border-radius: 0 10px 10px 0;
            font-size: 14px;
            color: #777;
            font-style: italic;
            line-height: 1.6;
        }

        .error-box {
            text-align: center;
            padding: 60px 20px;
            color: #888;
            background: #fff;
            border-radius: 20px;
            border: 1px solid #efefef;
        }
        .error-box .error-emoji { font-size: 48px; margin-bottom: 16px; }
        .error-box h3 { font-size: 20px; font-weight: 800; color: #222; margin-bottom: 8px; }
        .error-box p  { font-size: 14px; line-height: 1.6; }

        .nav-back {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #888;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 40px;
            transition: color 0.2s;
        }
        .nav-back:hover { color: #FF6B35; }

        .edition-cta {
            background: #111;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-top: 48px;
            margin-bottom: 60px;
        }
        .edition-cta p { color: rgba(255,255,255,0.5); font-size: 13px; margin-bottom: 8px; }
        .edition-cta h3 { color: #fff; font-size: 22px; font-weight: 900; margin-bottom: 24px; }
        .edition-cta h3 span { color: #FFD23F; }
        .edition-cta a {
            display: inline-block;
            padding: 14px 28px;
            background: #FF6B35;
            color: #fff;
            text-decoration: none;
            border-radius: 100px;
            font-weight: 700;
            font-size: 14px;
            transition: background 0.2s, transform 0.2s;
        }
        .edition-cta a:hover { background: #e55a25; transform: translateY(-2px); }
    </style>
</head>
<body>

    <!-- Sol animado igual ao site -->
    <div class="sun-container">
        <svg class="sun-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <linearGradient id="sunGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#FF6B35;stop-opacity:1">
                        <animate attributeName="stop-color" values="#FF6B35;#FFD23F;#FF6B35" dur="8s" repeatCount="indefinite"/>
                    </stop>
                    <stop offset="100%" style="stop-color:#FF8C61;stop-opacity:1">
                        <animate attributeName="stop-color" values="#FF8C61;#FFEB99;#FF8C61" dur="8s" repeatCount="indefinite"/>
                    </stop>
                </linearGradient>
            </defs>
            <circle cx="100" cy="100" r="60" fill="url(#sunGradient)">
                <animate attributeName="r" values="60;65;60" dur="4s" repeatCount="indefinite"/>
            </circle>
            <g transform="translate(100, 100)">
                <g class="rays">
                    <line x1="0" y1="-80" x2="0" y2="-95" stroke="#FF6B35" stroke-width="3" stroke-linecap="round"/>
                    <line x1="56" y1="-56" x2="67" y2="-67" stroke="#FF6B35" stroke-width="3" stroke-linecap="round"/>
                    <line x1="80" y1="0" x2="95" y2="0" stroke="#FF6B35" stroke-width="3" stroke-linecap="round"/>
                    <line x1="56" y1="56" x2="67" y2="67" stroke="#FF6B35" stroke-width="3" stroke-linecap="round"/>
                    <line x1="0" y1="80" x2="0" y2="95" stroke="#FF6B35" stroke-width="3" stroke-linecap="round"/>
                    <line x1="-56" y1="56" x2="-67" y2="67" stroke="#FF6B35" stroke-width="3" stroke-linecap="round"/>
                    <line x1="-80" y1="0" x2="-95" y2="0" stroke="#FF6B35" stroke-width="3" stroke-linecap="round"/>
                    <line x1="-56" y1="-56" x2="-67" y2="-67" stroke="#FF6B35" stroke-width="3" stroke-linecap="round"/>
                    <animateTransform attributeName="transform" attributeType="XML" type="rotate"
                        from="0" to="360" dur="60s" repeatCount="indefinite"/>
                </g>
            </g>
        </svg>
    </div>

    <div class="page-wrapper">

        <header class="hero" style="padding-bottom: 40px;">
            <a href="/edicoes.html" class="nav-back">‚Üê Arquivo de edi√ß√µes</a>

            <!-- Loading -->
            <div id="loadingArea" style="text-align:center; padding: 40px 0;">
                <div class="loading-spinner"></div>
                <p style="color:#888; font-size:14px;">Buscando sua edi√ß√£o...</p>
            </div>

            <!-- Conte√∫do do header (aparece ap√≥s carregar) -->
            <div id="headerContent" style="display:none;">
                <div class="edition-meta">‚òÄÔ∏è <span id="editionDateLabel"></span></div>
                <h1 class="title">
                    <span class="title-line">Pro dia nascer</span>
                    <span class="title-line accent">Feliz</span>
                </h1>
                <p class="subtitle" id="editionSubtitle"></p>
            </div>
        </header>

        <main class="content">
            <div id="sectionsContainer"></div>

            <div class="edition-cta" id="footerCta" style="display:none;">
                <p>Gostou desta edi√ß√£o?</p>
                <h3>Receba todo dia no seu <span>email</span></h3>
                <a href="/edicoes.html">‚Üê Ver outras edi√ß√µes</a>
            </div>
        </main>

        <footer class="footer">
            <p>¬© 2026 ‚Äî Pro dia nascer Feliz ¬∑ <a href="mailto:news.prodianascerfeliz@gmail.com">Contato</a> ¬∑ <a href="/privacidade.html">Privacidade</a></p>
        </footer>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwhz4hBt1cAojHParJ5xuVs8JQdwaaYZOtVW3JO0YhMWkTG34wg4HUp754wEm2qOdZb/exec';

        // Pega a data da URL: /edicoes/2026-02-27.html
        function getDateFromURL() {
            const match = window.location.pathname.match(/(\d{4}-\d{2}-\d{2})/);
            return match ? match[1] : null;
        }

        // Formata "2026-02-27" ‚Üí "27 de fevereiro de 2026"
        // Usa y,m,d separados para evitar fuso hor√°rio
        function formatDate(dateStr) {
            const [y, m, d] = dateStr.split('-').map(Number);
            return new Date(y, m - 1, d).toLocaleDateString('pt-BR', {
                day: 'numeric', month: 'long', year: 'numeric'
            });
        }

        // Mostra header e CTA ap√≥s carregar
        function showContent() {
            document.getElementById('loadingArea').style.display = 'none';
            document.getElementById('headerContent').style.display = 'block';
            document.getElementById('footerCta').style.display = 'block';
        }

        // Renderiza se√ß√µes
        function renderSections(ed) {
            const cfg = {
                viralizando: { tag: 'tag-viral',       emoji: 'üî•', label: 'Viralizando' },
                conspiracao:  { tag: 'tag-conspiracao', emoji: 'üîç', label: 'Conspira√ß√£o' },
                bastidores:   { tag: 'tag-bastidores',  emoji: 'üé≠', label: 'Bastidores'  },
            };

            let html = '';
            ['viralizando', 'conspiracao', 'bastidores'].forEach(tipo => {
                const s = ed[tipo];
                if (!s || !s.lead) return;
                const c = cfg[tipo];
                html += `
                    <div class="edition-card">
                        <div class="card-tag ${c.tag}">${c.emoji} ${c.label}</div>
                        <div class="card-lead">${s.lead}</div>
                        <div class="card-body">${s.corpo || ''}</div>
                        ${s.nugget ? `<div class="card-nugget">${s.nugget}</div>` : ''}
                    </div>`;
            });

            if (!html) {
                html = `<div class="error-box">
                    <div class="error-emoji">üì≠</div>
                    <h3>Conte√∫do n√£o dispon√≠vel</h3>
                    <p>Esta edi√ß√£o ainda n√£o foi gerada ou n√£o est√° dispon√≠vel.</p>
                </div>`;
            }

            document.getElementById('sectionsContainer').innerHTML = html;
        }

        // Busca da API via JSONP (sem CORS)
        function fetchEdition(date, email) {
            return new Promise((resolve, reject) => {
                const cb = 'edCb_' + Date.now();
                const script = document.createElement('script');

                const timer = setTimeout(() => {
                    script.remove(); delete window[cb];
                    reject(new Error('timeout'));
                }, 12000);

                window[cb] = function(data) {
                    clearTimeout(timer); script.remove(); delete window[cb];
                    resolve(data);
                };
                script.onerror = () => {
                    clearTimeout(timer); script.remove(); delete window[cb];
                    reject(new Error('network'));
                };

                script.src = `${API_URL}?action=get&date=${date}&email=${encodeURIComponent(email)}&callback=${cb}`;
                document.head.appendChild(script);
            });
        }

        // Inicializa
        async function init() {
            const date  = getDateFromURL();
            const email = localStorage.getItem('user_email');

            if (!date || !email) {
                window.location.href = '/edicoes.html';
                return;
            }

            // Atualiza cabe√ßalho
            const formatted = formatDate(date);
            document.getElementById('editionDateLabel').textContent = formatted.toUpperCase();
            document.getElementById('editionSubtitle').textContent =
                `Edi√ß√£o de ${formatted} ¬∑ preparada especialmente para voc√™`;
            document.title = `${formatted} ‚Äî Pro dia nascer Feliz`;

            try {
                const data = await fetchEdition(date, email);
                showContent();

                if (data && data.edition) {
                    renderSections(data.edition);
                } else if (data && data.error) {
                    document.getElementById('sectionsContainer').innerHTML = `
                        <div class="error-box">
                            <div class="error-emoji">üîí</div>
                            <h3>Acesso negado</h3>
                            <p>Este email n√£o est√° cadastrado. <a href="/" style="color:#FF6B35;">Cadastre-se gr√°tis</a></p>
                        </div>`;
                } else {
                    document.getElementById('sectionsContainer').innerHTML = `
                        <div class="error-box">
                            <div class="error-emoji">üì≠</div>
                            <h3>Edi√ß√£o n√£o encontrada</h3>
                            <p>Esta edi√ß√£o ainda n√£o est√° dispon√≠vel.</p>
                        </div>`;
                }

            } catch (err) {
                showContent();
                document.getElementById('sectionsContainer').innerHTML = `
                    <div class="error-box">
                        <div class="error-emoji">‚ö°</div>
                        <h3>Erro ao carregar</h3>
                        <p>N√£o foi poss√≠vel buscar o conte√∫do. Tente novamente em instantes.</p>
                    </div>`;
            }
        }

        init();
    </script>
</body>
</html>
