<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edi√ß√£o ‚Äî Pro dia nascer Feliz</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --orange: #FF6B35;
            --yellow: #FFD23F;
            --dark: #1a1a1a;
            --text: #333;
            --muted: #888;
            --bg: #faf9f7;
            --card-bg: #ffffff;
        }

        body {
            background: var(--bg);
            font-family: 'Inter', sans-serif;
            color: var(--text);
            min-height: 100vh;
        }

        /* Loading screen */
        #loadingScreen {
            position: fixed; inset: 0;
            background: var(--bg);
            display: flex; align-items: center; justify-content: center;
            flex-direction: column; gap: 20px;
            z-index: 100;
            transition: opacity 0.4s;
        }
        .loading-sun {
            width: 60px; height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--orange), var(--yellow));
            animation: pulse 1.2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.15); opacity: 0.8; }
        }
        #loadingScreen p { color: var(--muted); font-size: 14px; }

        /* Header */
        .site-header {
            border-bottom: 1px solid #eee;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #fff;
            position: sticky; top: 0; z-index: 10;
        }
        .site-header a {
            color: var(--muted);
            text-decoration: none;
            font-size: 14px;
            display: flex; align-items: center; gap: 6px;
            transition: color 0.2s;
        }
        .site-header a:hover { color: var(--orange); }
        .header-logo {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            color: var(--dark);
            font-weight: 700;
        }
        .header-logo span { color: var(--orange); }

        /* Page */
        .page {
            max-width: 680px;
            margin: 0 auto;
            padding: 48px 24px 80px;
        }

        /* Edition header */
        .edition-header {
            margin-bottom: 48px;
            padding-bottom: 32px;
            border-bottom: 2px solid #f0f0f0;
        }
        .edition-date {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,107,53,0.08);
            border: 1px solid rgba(255,107,53,0.2);
            color: var(--orange);
            font-size: 13px;
            font-weight: 600;
            padding: 6px 14px;
            border-radius: 100px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .edition-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(32px, 6vw, 48px);
            font-weight: 900;
            color: var(--dark);
            line-height: 1.1;
            margin-bottom: 12px;
        }
        .edition-title span { color: var(--orange); }
        .edition-subtitle {
            color: var(--muted);
            font-size: 15px;
            line-height: 1.5;
        }

        /* Section cards */
        .section-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 24px;
            border: 1px solid #efefef;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeUp 0.5s ease forwards;
        }
        .section-card:nth-child(1) { animation-delay: 0.1s; }
        .section-card:nth-child(2) { animation-delay: 0.2s; }
        .section-card:nth-child(3) { animation-delay: 0.3s; }

        @keyframes fadeUp {
            to { opacity: 1; transform: translateY(0); }
        }

        .section-tag {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 5px 12px;
            border-radius: 100px;
            margin-bottom: 16px;
        }
        .tag-viral  { background: #fff3e0; color: #e65100; }
        .tag-conspiracao { background: #f3e5f5; color: #7b1fa2; }
        .tag-bastidores { background: #e8f5e9; color: #2e7d32; }

        .section-lead {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            line-height: 1.3;
            margin-bottom: 14px;
        }
        .section-body {
            font-size: 15px;
            line-height: 1.75;
            color: #444;
        }
        .section-nugget {
            margin-top: 20px;
            padding: 16px 20px;
            background: #faf9f7;
            border-left: 3px solid var(--orange);
            border-radius: 0 10px 10px 0;
            font-size: 14px;
            color: var(--muted);
            font-style: italic;
            line-height: 1.6;
        }

        /* Error / not found */
        .error-box {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted);
        }
        .error-box .emoji { font-size: 48px; margin-bottom: 16px; }
        .error-box h3 { font-size: 20px; color: var(--dark); margin-bottom: 8px; }
        .error-box p { font-size: 14px; line-height: 1.6; }

        /* Footer CTA */
        .footer-cta {
            margin-top: 56px;
            padding: 40px;
            background: var(--dark);
            border-radius: 20px;
            text-align: center;
            color: #fff;
        }
        .footer-cta p { font-size: 14px; opacity: 0.6; margin-bottom: 8px; }
        .footer-cta h3 {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            margin-bottom: 24px;
        }
        .footer-cta h3 span { color: var(--yellow); }
        .back-btn {
            display: inline-block;
            padding: 14px 28px;
            background: var(--orange);
            color: #fff;
            text-decoration: none;
            border-radius: 100px;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, background 0.2s;
        }
        .back-btn:hover { transform: translateY(-2px); background: #e55a25; }
    </style>
</head>
<body>

    <!-- Loading -->
    <div id="loadingScreen">
        <div class="loading-sun"></div>
        <p>Buscando sua edi√ß√£o...</p>
    </div>

    <!-- Header -->
    <header class="site-header">
        <a href="/edicoes.html">‚Üê Arquivo de edi√ß√µes</a>
        <div class="header-logo">Pro dia nascer <span>Feliz</span></div>
        <div style="width:120px"></div>
    </header>

    <!-- Content -->
    <div class="page" id="pageContent" style="display:none;">
        <div class="edition-header">
            <div class="edition-date">‚òÄÔ∏è <span id="editionDateLabel">Edi√ß√£o</span></div>
            <h1 class="edition-title">Pro dia nascer <span>Feliz</span></h1>
            <p class="edition-subtitle" id="editionSubtitle">Seu resumo di√°rio do que importa</p>
        </div>

        <div id="sectionsContainer"></div>

        <div class="footer-cta">
            <p>Gostou desta edi√ß√£o?</p>
            <h3>Receba todo dia no seu <span>email</span></h3>
            <a href="/" class="back-btn">‚Üê Voltar para home</a>
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwhz4hBt1cAojHParJ5xuVs8JQdwaaYZOtVW3JO0YhMWkTG34wg4HUp754wEm2qOdZb/exec';

        // Pega a data da URL: /edicoes/2026-02-27.html
        function getDateFromURL() {
            const path = window.location.pathname;
            const match = path.match(/(\d{4}-\d{2}-\d{2})/);
            return match ? match[1] : null;
        }

        // Formata data para exibi√ß√£o
        function formatDate(dateStr) {
            const [y, m, d] = dateStr.split('-');
            const date = new Date(y, m - 1, d);
            return date.toLocaleDateString('pt-BR', { day: 'numeric', month: 'long', year: 'numeric' });
        }

        // Configura√ß√µes das se√ß√µes
        const SECTION_CONFIG = {
            'VIRALIZANDO': { tag: 'tag-viral', emoji: 'üî•', label: 'Viralizando' },
            'CONSPIRACAO':  { tag: 'tag-conspiracao', emoji: 'üîç', label: 'Conspira√ß√£o' },
            'BASTIDORES':   { tag: 'tag-bastidores', emoji: 'üé≠', label: 'Bastidores' },
        };

        // Renderiza as se√ß√µes
        function renderSections(sections) {
            const container = document.getElementById('sectionsContainer');
            
            // Ordem desejada
            const order = ['VIRALIZANDO', 'CONSPIRACAO', 'BASTIDORES'];
            const sorted = order
                .map(type => sections.find(s => s.tipo === type || s.type === type))
                .filter(Boolean);

            if (sorted.length === 0) {
                container.innerHTML = `
                    <div class="error-box">
                        <div class="emoji">üì≠</div>
                        <h3>Conte√∫do n√£o encontrado</h3>
                        <p>Esta edi√ß√£o pode n√£o ter sido gerada ainda.</p>
                    </div>`;
                return;
            }

            container.innerHTML = sorted.map(s => {
                const tipo = (s.tipo || s.type || '').toUpperCase();
                const cfg = SECTION_CONFIG[tipo] || { tag: 'tag-viral', emoji: 'üì∞', label: tipo };
                return `
                    <div class="section-card">
                        <div class="section-tag ${cfg.tag}">${cfg.emoji} ${cfg.label}</div>
                        <div class="section-lead">${s.lead || s.titulo || ''}</div>
                        <div class="section-body">${s.corpo || s.body || ''}</div>
                        ${s.nugget ? `<div class="section-nugget">${s.nugget}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Busca conte√∫do via JSONP
        function fetchEdition(date, email) {
            return new Promise((resolve, reject) => {
                const cbName = 'editionCb_' + Date.now();
                const script = document.createElement('script');

                const timeout = setTimeout(() => {
                    script.remove();
                    delete window[cbName];
                    reject(new Error('timeout'));
                }, 10000);

                window[cbName] = function(data) {
                    clearTimeout(timeout);
                    script.remove();
                    delete window[cbName];
                    resolve(data);
                };

                script.onerror = () => {
                    clearTimeout(timeout);
                    script.remove();
                    delete window[cbName];
                    reject(new Error('script error'));
                };

                const params = `action=get&date=${date}&email=${encodeURIComponent(email)}&callback=${cbName}`;
                script.src = `${API_URL}?${params}`;
                document.head.appendChild(script);
            });
        }

        // Inicializa a p√°gina
        async function init() {
            const date = getDateFromURL();
            const email = localStorage.getItem('user_email');

            if (!date) {
                window.location.href = '/edicoes.html';
                return;
            }

            // Sem email ‚Üí volta para edicoes
            if (!email) {
                window.location.href = '/edicoes.html';
                return;
            }

            // Atualiza cabe√ßalho
            document.getElementById('editionDateLabel').textContent = formatDate(date);
            document.getElementById('editionSubtitle').textContent =
                `Edi√ß√£o de ${formatDate(date)} ¬∑ preparada especialmente para voc√™`;
            document.title = `Edi√ß√£o ${formatDate(date)} ‚Äî Pro dia nascer Feliz`;

            try {
                const data = await fetchEdition(date, email);

                // Esconde loading, mostra conte√∫do
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => document.getElementById('loadingScreen').style.display = 'none', 400);
                document.getElementById('pageContent').style.display = 'block';

                if (data && data.sections && data.sections.length > 0) {
                    renderSections(data.sections);
                } else if (data && data.content) {
                    // Formato alternativo
                    renderSections(data.content);
                } else {
                    document.getElementById('sectionsContainer').innerHTML = `
                        <div class="error-box">
                            <div class="emoji">üì≠</div>
                            <h3>Edi√ß√£o n√£o dispon√≠vel</h3>
                            <p>Esta edi√ß√£o ainda n√£o foi gerada ou n√£o est√° dispon√≠vel.</p>
                        </div>`;
                }

            } catch (err) {
                // Mesmo com erro, mostra a p√°gina
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => document.getElementById('loadingScreen').style.display = 'none', 400);
                document.getElementById('pageContent').style.display = 'block';

                document.getElementById('sectionsContainer').innerHTML = `
                    <div class="error-box">
                        <div class="emoji">‚ö°</div>
                        <h3>Erro ao carregar</h3>
                        <p>N√£o foi poss√≠vel buscar o conte√∫do desta edi√ß√£o. Tente novamente em instantes.</p>
                    </div>`;
            }
        }

        init();
    </script>
</body>
</html>
